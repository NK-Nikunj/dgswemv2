machine:
  python:
    version: 2.7.11

dependencies:
  pre:
    - sudo add-apt-repository -y ppa:ubuntu-toolchain-r/test && sudo add-apt-repository -y ppa:ppsspp/cmake
    - sudo apt-get update
    - sudo apt-get install -y gcc-6 g++-6 cmake libgoogle-perftools-dev libhwloc-dev mpi-default-dev openmpi-bin
    - sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-6 20
    - sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-6 20
    - ./scripts/circleci/set-up-dependencies.sh
    - sudo apt-get install python-dev
    - pip install numpy
  cache_directories:
    - "/home/ubuntu/yaml-cpp"
    - "/home/ubuntu/hpx"
    - "/home/ubuntu/build"
    - "/home/ubuntu/install"
compile:
  override:
    - scripts/circleci/build.sh

test:
  override:
    - scripts/circleci/test.sh
    - scripts/correctness/test_parallel_correctness.sh
    - scripts/correctness/test_parallel_weirs.sh